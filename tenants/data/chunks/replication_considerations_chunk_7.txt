 fail over
rg2
first, a
dangling reference
occurs. An error message tells you to place the session policy
database in the replication or failover group that contains the roles. This behavior occurs when the session policy is set on the account
or users.
If the session policy and account level objects are in different replication groups, and the session policy is not set on the account or
users, you can replicate and refresh the target account. Be sure to refresh for the replication group that contains the account level
objects first.
If you refresh the target account after replicating or failing over the session policy with secondary roles and role objects, the target
account reflects the session policy and secondary roles behavior in the source account.
Additionally, when you refresh the database in the target account and the database contains a session policy that references secondary
roles,
ALLOWED_SECONDARY_ROLES
always evaluates to
[ALL]
.
Replication and secrets
¶
You can only replicate the secret using a replication or failover group. Specify the database that contains the secret, the database that
contains UDFs or procedures that reference the secret, and the integrations that reference the secret in a single replication or failover
group.
If you have the database that contains the secret in one replication or failover group and the integration that references the secret in a
different replication or failover group, then:
If you replicate the integration first and then the secret, the operation is successful: all objects are replicated and there are no
dangling references.
If you replicate the secret before the integration and the secret does not already exist in the target account, a “placeholder secret” is
added in the target account to prevent a dangling reference. Snowflake maps the placeholder secret to the integration.
After you replicate the group that contains the integration, on the next refresh operation for the group that contains the secret,
Snowflake updates the target account to replace the placeholder secret with the secret that is referenced in the integration.
If you replicate the secret and do not replicate the integration from
account1
to
account2
, the integration doesn’t work in the
target account (
account2
) because there is no integration to use the secret. Additionally, if you failover and the target account is
promoted to source account, the integration will not work.
When you decide to failover to make
account1
as the source account, the secret and integration references